<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Danh sách sách - Thư viện Mini</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/books.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="container">
            <div class="logo">
                <i class="fas fa-book"></i>
                <h1>Thư viện Mini</h1>
            </div>
            <nav class="nav">
                <a href="index.html" class="nav-link">Trang chủ</a>
                <a href="books.html" class="nav-link active">Sách</a>
                <a href="about.html" class="nav-link">Giới thiệu</a>
                <a href="contact.html" class="nav-link">Liên hệ</a>
            </nav>
            <div class="auth-buttons">
                <button class="btn btn-outline" onclick="openLoginModal()">Đăng nhập</button>
                <button class="btn btn-primary" onclick="openRegisterModal()">Đăng ký</button>
            </div>
        </div>
    </header>

    <main>
        <div class="container">
            <!-- Search and Filters -->
            <section class="filters">
                <h4><i class="fas fa-filter"></i> Tìm kiếm và lọc sách</h4>
                <div class="filter-row">
                    <div class="form-group">
                        <label for="bookSearch">Tìm kiếm</label>
                        <input type="text" id="bookSearch" placeholder="Tên sách, tác giả...">
                    </div>
                    <div class="form-group">
                        <label for="categoryFilter">Thể loại</label>
                        <select id="categoryFilter">
                            <option value="">Tất cả thể loại</option>
                            <option value="Kỹ năng sống">Kỹ năng sống</option>
                            <option value="Phát triển bản thân">Phát triển bản thân</option>
                            <option value="Tiểu thuyết">Tiểu thuyết</option>
                            <option value="Lịch sử">Lịch sử</option>
                            <option value="Khoa học">Khoa học</option>
                            <option value="Văn học">Văn học</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="statusFilter">Trạng thái</label>
                        <select id="statusFilter">
                            <option value="">Tất cả</option>
                            <option value="available">Có sẵn</option>
                            <option value="borrowed">Đã mượn</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <button class="btn btn-primary" onclick="applyFilters()">
                            <i class="fas fa-search"></i> Lọc
                        </button>
                        <button class="btn btn-outline" onclick="clearFilters()">
                            <i class="fas fa-times"></i> Xóa bộ lọc
                        </button>
                    </div>
                </div>
            </section>

            <!-- Search Results Info -->
            <div id="searchInfo" class="search-info" style="display: none;">
                <h3>Kết quả tìm kiếm</h3>
                <p id="searchInfoText"></p>
            </div>

            <!-- Books Grid -->
            <section class="books-listing">
                <div class="books-header">
                    <h3>Danh sách sách</h3>
                    <div class="view-options">
                        <button class="btn btn-small view-btn active" onclick="changeView('grid')" data-view="grid">
                            <i class="fas fa-th"></i> Lưới
                        </button>
                        <button class="btn btn-small view-btn" onclick="changeView('list')" data-view="list">
                            <i class="fas fa-list"></i> Danh sách
                        </button>
                    </div>
                </div>

                <!-- Grid View -->
                <div id="booksGrid" class="books-grid">
                    <!-- Books will be loaded here by JavaScript -->
                </div>

                <!-- List View -->
                <div id="booksList" class="books-list" style="display: none;">
                    <div class="table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Hình ảnh</th>
                                    <th>Tên sách</th>
                                    <th>Tác giả</th>
                                    <th>Thể loại</th>
                                    <th>Trạng thái</th>
                                    <th>Lượt mượn</th>
                                    <th>Hành động</th>
                                </tr>
                            </thead>
                            <tbody id="booksTableBody">
                                <!-- Books will be loaded here by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- No Results Message -->
                <div id="noResults" class="no-results" style="display: none;">
                    <div class="no-results-content">
                        <i class="fas fa-search"></i>
                        <h3>Không tìm thấy sách nào</h3>
                        <p>Thử thay đổi từ khóa tìm kiếm hoặc bộ lọc của bạn.</p>
                    </div>
                </div>
            </section>

            <!-- Pagination -->
            <div id="pagination" class="pagination">
                <!-- Pagination will be generated by JavaScript -->
            </div>
        </div>
    </main>

    <!-- Book Detail Modal -->
    <div id="bookDetailModal" class="modal">
        <div class="modal-content" style="max-width: 800px;">
            <span class="close" onclick="closeModal('bookDetailModal')">&times;</span>
            <div id="bookDetailContent">
                <!-- Book detail will be loaded here -->
            </div>
        </div>
    </div>

    <!-- Login Modal -->
    <div id="loginModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('loginModal')">&times;</span>
            <h3>Đăng nhập</h3>
            <form id="loginForm">
                <div class="form-group">
                    <label for="loginEmail">Email</label>
                    <input type="email" id="loginEmail" required>
                </div>
                <div class="form-group">
                    <label for="loginPassword">Mật khẩu</label>
                    <input type="password" id="loginPassword" required>
                </div>
                <div class="form-group">
                    <label>
                        <input type="radio" name="userType" value="reader" checked> Độc giả
                    </label>
                    <label>
                        <input type="radio" name="userType" value="admin"> Quản trị viên
                    </label>
                </div>
                <button type="submit" class="btn btn-primary btn-full">Đăng nhập</button>
            </form>
        </div>
    </div>

    <!-- Register Modal -->
    <div id="registerModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('registerModal')">&times;</span>
            <h3>Đăng ký tài khoản</h3>
            <form id="registerForm">
                <div class="form-group">
                    <label for="registerName">Họ và tên</label>
                    <input type="text" id="registerName" required>
                </div>
                <div class="form-group">
                    <label for="registerEmail">Email</label>
                    <input type="email" id="registerEmail" required>
                </div>
                <div class="form-group">
                    <label for="registerPhone">Số điện thoại</label>
                    <input type="tel" id="registerPhone" required>
                </div>
                <div class="form-group">
                    <label for="registerPassword">Mật khẩu</label>
                    <input type="password" id="registerPassword" required>
                </div>
                <div class="form-group">
                    <label for="confirmPassword">Xác nhận mật khẩu</label>
                    <input type="password" id="confirmPassword" required>
                </div>
                <button type="submit" class="btn btn-primary btn-full">Đăng ký</button>
            </form>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h4>Thư viện Mini</h4>
                    <p>Nơi tri thức hội tụ và lan tỏa</p>
                </div>
                <div class="footer-section">
                    <h4>Liên kết nhanh</h4>
                    <ul>
                        <li><a href="books.html">Danh sách sách</a></li>
                        <li><a href="about.html">Giới thiệu</a></li>
                        <li><a href="contact.html">Liên hệ</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h4>Liên hệ</h4>
                    <p><i class="fas fa-phone"></i> (84) 123-456-789</p>
                    <p><i class="fas fa-envelope"></i> info@thuvienMini.com</p>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 Thư viện Mini. Tất cả quyền được bảo lưu.</p>
            </div>
        </div>
    </footer>

    <script src="js/main.js"></script>
    <script>
        let currentView = 'grid';
        let currentPage = 1;
        let booksPerPage = 12;
        let filteredBooks = [];

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            loadBooksFromStorage();
            loadBooks();
            setupEventListeners();
        });

        function loadBooksFromStorage() {
            // Check for search results
            const searchResults = localStorage.getItem('searchResults');
            const searchQuery = localStorage.getItem('searchQuery');
            
            if (searchResults && searchQuery) {
                filteredBooks = JSON.parse(searchResults);
                document.getElementById('searchInfo').style.display = 'block';
                document.getElementById('searchInfoText').textContent = 
                    `Tìm thấy ${filteredBooks.length} kết quả cho "${searchQuery}"`;
                
                // Clear search from localStorage
                localStorage.removeItem('searchResults');
                localStorage.removeItem('searchQuery');
            } else {
                filteredBooks = [...window.libraryApp.books];
            }
        }

        function setupEventListeners() {
            // Search input
            document.getElementById('bookSearch').addEventListener('keyup', function(e) {
                if (e.key === 'Enter') {
                    applyFilters();
                }
            });

            // Filter changes
            document.getElementById('categoryFilter').addEventListener('change', applyFilters);
            document.getElementById('statusFilter').addEventListener('change', applyFilters);
        }

        function loadBooks() {
            const startIndex = (currentPage - 1) * booksPerPage;
            const endIndex = startIndex + booksPerPage;
            const booksToShow = filteredBooks.slice(startIndex, endIndex);

            if (booksToShow.length === 0) {
                showNoResults();
                return;
            }

            hideNoResults();

            if (currentView === 'grid') {
                renderBooksGrid(booksToShow);
            } else {
                renderBooksList(booksToShow);
            }

            renderPagination();
        }

        function renderBooksGrid(books) {
            const grid = document.getElementById('booksGrid');
            grid.innerHTML = books.map(book => `
                <div class="book-card fade-in">
                    <div class="book-image">
                        <img src="${book.image}" alt="${book.title}">
                        <div class="book-status ${book.status}">
                            ${book.status === 'available' ? 'Có sẵn' : 'Đã mượn'}
                        </div>
                    </div>
                    <div class="book-info">
                        <h4>${book.title}</h4>
                        <p class="author">${book.author}</p>
                        <p class="category">${book.category}</p>
                        <div class="book-actions">
                            <button class="btn btn-primary btn-small" onclick="viewBookDetailModal(${book.id})">
                                <i class="fas fa-eye"></i> Chi tiết
                            </button>
                            ${book.status === 'available' ? 
                                `<button class="btn btn-success btn-small" onclick="borrowBookAction(${book.id})">
                                    <i class="fas fa-hand-holding"></i> Mượn
                                </button>` : 
                                `<button class="btn btn-outline btn-small" disabled>
                                    <i class="fas fa-ban"></i> Đã mượn
                                </button>`
                            }
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function renderBooksList(books) {
            const tbody = document.getElementById('booksTableBody');
            tbody.innerHTML = books.map(book => `
                <tr class="fade-in">
                    <td>
                        <img src="${book.image}" alt="${book.title}" 
                             style="width: 50px; height: 70px; object-fit: cover; border-radius: 5px;">
                    </td>
                    <td>
                        <strong>${book.title}</strong>
                    </td>
                    <td>${book.author}</td>
                    <td><span class="badge">${book.category}</span></td>
                    <td>
                        <span class="status-badge ${book.status}">
                            ${book.status === 'available' ? 'Có sẵn' : 'Đã mượn'}
                        </span>
                    </td>
                    <td>${book.borrowCount || 0}</td>
                    <td class="actions">
                        <button class="btn btn-primary btn-small" onclick="viewBookDetailModal(${book.id})">
                            <i class="fas fa-eye"></i>
                        </button>
                        ${book.status === 'available' ? 
                            `<button class="btn btn-success btn-small" onclick="borrowBookAction(${book.id})">
                                <i class="fas fa-hand-holding"></i>
                            </button>` : 
                            `<button class="btn btn-outline btn-small" disabled>
                                <i class="fas fa-ban"></i>
                            </button>`
                        }
                    </td>
                </tr>
            `).join('');
        }

        function changeView(view) {
            currentView = view;
            
            // Update view buttons
            document.querySelectorAll('.view-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`[data-view="${view}"]`).classList.add('active');
            
            // Show/hide appropriate containers
            if (view === 'grid') {
                document.getElementById('booksGrid').style.display = 'grid';
                document.getElementById('booksList').style.display = 'none';
            } else {
                document.getElementById('booksGrid').style.display = 'none';
                document.getElementById('booksList').style.display = 'block';
            }
            
            loadBooks();
        }

        function applyFilters() {
            const searchQuery = document.getElementById('bookSearch').value.toLowerCase();
            const categoryFilter = document.getElementById('categoryFilter').value;
            const statusFilter = document.getElementById('statusFilter').value;
            
            filteredBooks = window.libraryApp.books.filter(book => {
                const matchesSearch = !searchQuery || 
                    book.title.toLowerCase().includes(searchQuery) ||
                    book.author.toLowerCase().includes(searchQuery);
                
                const matchesCategory = !categoryFilter || book.category === categoryFilter;
                const matchesStatus = !statusFilter || book.status === statusFilter;
                
                return matchesSearch && matchesCategory && matchesStatus;
            });
            
            currentPage = 1;
            updateSearchInfo();
            loadBooks();
        }

        function clearFilters() {
            document.getElementById('bookSearch').value = '';
            document.getElementById('categoryFilter').value = '';
            document.getElementById('statusFilter').value = '';
            
            filteredBooks = [...window.libraryApp.books];
            currentPage = 1;
            document.getElementById('searchInfo').style.display = 'none';
            loadBooks();
        }

        function updateSearchInfo() {
            const searchInfo = document.getElementById('searchInfo');
            const searchText = document.getElementById('searchInfoText');
            
            if (filteredBooks.length < window.libraryApp.books.length) {
                searchInfo.style.display = 'block';
                searchText.textContent = `Tìm thấy ${filteredBooks.length} kết quả từ ${window.libraryApp.books.length} sách`;
            } else {
                searchInfo.style.display = 'none';
            }
        }

        function viewBookDetailModal(bookId) {
            const book = window.libraryApp.books.find(b => b.id === bookId);
            if (!book) return;

            const modal = document.getElementById('bookDetailModal');
            const content = document.getElementById('bookDetailContent');
            
            content.innerHTML = `
                <div class="book-detail-modal">
                    <div class="book-detail-image">
                        <img src="${book.image}" alt="${book.title}">
                        <div class="book-status-large ${book.status}">
                            ${book.status === 'available' ? 'Có sẵn' : 'Đã mượn'}
                        </div>
                    </div>
                    <div class="book-detail-info">
                        <h2>${book.title}</h2>
                        <p class="book-author"><i class="fas fa-user"></i> ${book.author}</p>
                        <p class="book-category"><i class="fas fa-tag"></i> ${book.category}</p>
                        <p class="book-borrow-count"><i class="fas fa-chart-line"></i> Đã mượn ${book.borrowCount || 0} lần</p>
                        
                        <div class="book-description">
                            <h4>Mô tả</h4>
                            <p>${book.description}</p>
                        </div>
                        
                        <div class="book-actions">
                            ${book.status === 'available' ? 
                                `<button class="btn btn-primary" onclick="borrowBookAction(${book.id}); closeModal('bookDetailModal')">
                                    <i class="fas fa-hand-holding"></i> Mượn sách
                                </button>` : 
                                `<button class="btn btn-outline" disabled>
                                    <i class="fas fa-ban"></i> Sách đã được mượn
                                </button>`
                            }
                        </div>
                    </div>
                </div>
            `;
            
            modal.style.display = 'block';
        }

        function borrowBookAction(bookId) {
            if (window.libraryApp.borrowBook(bookId)) {
                // Refresh the current view
                loadBooks();
            }
        }

        function renderPagination() {
            const totalPages = Math.ceil(filteredBooks.length / booksPerPage);
            const pagination = document.getElementById('pagination');
            
            if (totalPages <= 1) {
                pagination.innerHTML = '';
                return;
            }
            
            let paginationHTML = '';
            
            // Previous button
            if (currentPage > 1) {
                paginationHTML += `
                    <button class="btn btn-outline btn-small" onclick="changePage(${currentPage - 1})">
                        <i class="fas fa-chevron-left"></i> Trước
                    </button>
                `;
            }
            
            // Page numbers
            for (let i = 1; i <= totalPages; i++) {
                if (i === currentPage) {
                    paginationHTML += `<button class="btn btn-primary btn-small">${i}</button>`;
                } else if (i === 1 || i === totalPages || Math.abs(i - currentPage) <= 2) {
                    paginationHTML += `<button class="btn btn-outline btn-small" onclick="changePage(${i})">${i}</button>`;
                } else if (i === currentPage - 3 || i === currentPage + 3) {
                    paginationHTML += `<span>...</span>`;
                }
            }
            
            // Next button
            if (currentPage < totalPages) {
                paginationHTML += `
                    <button class="btn btn-outline btn-small" onclick="changePage(${currentPage + 1})">
                        Sau <i class="fas fa-chevron-right"></i>
                    </button>
                `;
            }
            
            pagination.innerHTML = paginationHTML;
        }

        function changePage(page) {
            currentPage = page;
            loadBooks();
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function showNoResults() {
            document.getElementById('noResults').style.display = 'block';
            document.getElementById('booksGrid').style.display = 'none';
            document.getElementById('booksList').style.display = 'none';
            document.getElementById('pagination').innerHTML = '';
        }

        function hideNoResults() {
            document.getElementById('noResults').style.display = 'none';
            if (currentView === 'grid') {
                document.getElementById('booksGrid').style.display = 'grid';
                document.getElementById('booksList').style.display = 'none';
            } else {
                document.getElementById('booksGrid').style.display = 'none';
                document.getElementById('booksList').style.display = 'block';
            }
        }
    </script>

    <style>
        .book-detail-modal {
            display: flex;
            gap: 2rem;
            align-items: flex-start;
        }

        .book-detail-image {
            flex: 0 0 300px;
            position: relative;
        }

        .book-detail-image img {
            width: 100%;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .book-status-large {
            position: absolute;
            top: 15px;
            right: 15px;
            padding: 8px 15px;
            border-radius: 25px;
            font-weight: 600;
            text-transform: uppercase;
            font-size: 0.9rem;
        }

        .book-detail-info {
            flex: 1;
        }

        .book-detail-info h2 {
            margin-bottom: 1rem;
            color: #333;
            font-size: 2rem;
        }

        .book-detail-info p {
            margin-bottom: 0.8rem;
            font-size: 1.1rem;
        }

        .book-author {
            color: #667eea;
            font-weight: 600;
        }

        .book-category {
            color: #666;
        }

        .book-borrow-count {
            color: #51cf66;
            font-weight: 500;
        }

        .book-description {
            margin: 2rem 0;
            padding: 1.5rem;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .book-description h4 {
            margin-bottom: 1rem;
            color: #333;
        }

        .book-actions {
            margin-top: 2rem;
        }

        .books-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }

        .view-options {
            display: flex;
            gap: 0.5rem;
        }

        .search-info {
            background: #e3f2fd;
            padding: 1rem 2rem;
            border-radius: 10px;
            margin-bottom: 2rem;
            border-left: 4px solid #667eea;
        }

        .search-info h3 {
            margin-bottom: 0.5rem;
            color: #333;
        }

        .no-results {
            text-align: center;
            padding: 4rem 2rem;
        }

        .no-results-content i {
            font-size: 4rem;
            color: #999;
            margin-bottom: 1rem;
        }

        .no-results-content h3 {
            margin-bottom: 1rem;
            color: #666;
        }

        .badge {
            background: #f0f0f0;
            color: #666;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
        }

        .status-badge {
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .status-badge.available {
            background: #d4edda;
            color: #155724;
        }

        .status-badge.borrowed {
            background: #f8d7da;
            color: #721c24;
        }

        .pagination {
            display: flex;
            justify-content: center;
            gap: 0.5rem;
            margin: 2rem 0;
            align-items: center;
        }

        .book-actions {
            display: flex;
            gap: 0.5rem;
            margin-top: 1rem;
        }

        @media (max-width: 768px) {
            .book-detail-modal {
                flex-direction: column;
            }
            
            .book-detail-image {
                flex: none;
                max-width: 200px;
                margin: 0 auto;
            }
            
            .books-header {
                flex-direction: column;
                gap: 1rem;
                align-items: flex-start;
            }
            
            .filter-row {
                grid-template-columns: 1fr;
            }
        }
    </style>
</body>
</html>