<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Thư viện Mini</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/dashboard.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="container">
            <div class="logo">
                <i class="fas fa-book"></i>
                <h1>Thư viện Mini</h1>
            </div>
            <nav class="nav">
                <a href="index.html" class="nav-link">Trang chủ</a>
                <a href="books.html" class="nav-link">Sách</a>
                <a href="user-dashboard.html" class="nav-link active">Dashboard</a>
                <a href="about.html" class="nav-link">Giới thiệu</a>
            </nav>
            <div class="auth-buttons">
                <span class="user-welcome">Xin chào, <span id="userName">Độc giả</span></span>
                <button class="btn btn-outline" onclick="logout()">
                    <i class="fas fa-sign-out-alt"></i> Đăng xuất
                </button>
            </div>
        </div>
    </header>

    <main>
        <div class="container">
            <!-- User Profile Section -->
            <section class="user-profile">
                <div class="profile-card">
                    <div class="profile-avatar">
                        <i class="fas fa-user-circle"></i>
                    </div>
                    <div class="profile-info">
                        <h2 id="userFullName">Tên người dùng</h2>
                        <p id="userEmail">email@example.com</p>
                        <p id="userPhone">Số điện thoại</p>
                        <small>Thành viên từ: <span id="joinDate">01/01/2024</span></small>
                    </div>
                    <button class="btn btn-primary" onclick="openEditProfileModal()">
                        <i class="fas fa-edit"></i> Chỉnh sửa thông tin
                    </button>
                </div>
            </section>

            <!-- Quick Stats -->
            <section class="user-stats">
                <div class="stat-item">
                    <div class="stat-icon">
                        <i class="fas fa-book-open"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="currentlyBorrowing">0</h3>
                        <p>Đang mượn</p>
                    </div>
                </div>

                <div class="stat-item">
                    <div class="stat-icon">
                        <i class="fas fa-history"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="totalBorrowed">0</h3>
                        <p>Đã mượn</p>
                    </div>
                </div>

                <div class="stat-item">
                    <div class="stat-icon">
                        <i class="fas fa-star"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="favoriteGenre">Chưa có</h3>
                        <p>Thể loại yêu thích</p>
                    </div>
                </div>

                <div class="stat-item">
                    <div class="stat-icon">
                        <i class="fas fa-clock"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="avgBorrowTime">0</h3>
                        <p>Ngày mượn TB</p>
                    </div>
                </div>
            </section>

            <!-- Currently Borrowed Books -->
            <section class="dashboard-card">
                <h3><i class="fas fa-book-reader"></i> Sách đang mượn</h3>
                <div id="currentBooksContainer">
                    <!-- Current books will be loaded here -->
                </div>
            </section>

            <!-- Borrow History -->
            <section class="dashboard-card">
                <h3><i class="fas fa-history"></i> Lịch sử mượn sách</h3>
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Sách</th>
                                <th>Tác giả</th>
                                <th>Ngày mượn</th>
                                <th>Ngày trả</th>
                                <th>Trạng thái</th>
                                <th>Hành động</th>
                            </tr>
                        </thead>
                        <tbody id="borrowHistoryTable">
                            <!-- Borrow history will be loaded here -->
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Quick Search -->
            <section class="dashboard-card">
                <h3><i class="fas fa-search"></i> Tìm kiếm sách nhanh</h3>
                <div class="quick-search">
                    <div class="search-box">
                        <i class="fas fa-search"></i>
                        <input type="text" id="quickSearchInput" placeholder="Tìm sách theo tên, tác giả...">
                        <button class="search-btn" onclick="quickSearch()">Tìm kiếm</button>
                    </div>
                </div>
                <div id="quickSearchResults" class="quick-search-results" style="display: none;">
                    <!-- Search results will be shown here -->
                </div>
            </section>

            <!-- Recommended Books -->
            <section class="dashboard-card">
                <h3><i class="fas fa-thumbs-up"></i> Sách gợi ý cho bạn</h3>
                <div id="recommendedBooks" class="books-grid">
                    <!-- Recommended books will be loaded here -->
                </div>
            </section>
        </div>
    </main>

    <!-- Edit Profile Modal -->
    <div id="editProfileModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('editProfileModal')">&times;</span>
            <h3>Chỉnh sửa thông tin cá nhân</h3>
            <form id="editProfileForm">
                <div class="form-group">
                    <label for="editName">Họ và tên</label>
                    <input type="text" id="editName" required>
                </div>
                <div class="form-group">
                    <label for="editEmail">Email</label>
                    <input type="email" id="editEmail" required readonly>
                </div>
                <div class="form-group">
                    <label for="editPhone">Số điện thoại</label>
                    <input type="tel" id="editPhone" required>
                </div>
                <div class="form-group">
                    <label for="editPassword">Mật khẩu mới (để trống nếu không thay đổi)</label>
                    <input type="password" id="editPassword">
                </div>
                <div class="form-group">
                    <label for="confirmNewPassword">Xác nhận mật khẩu mới</label>
                    <input type="password" id="confirmNewPassword">
                </div>
                <button type="submit" class="btn btn-primary btn-full">Cập nhật thông tin</button>
            </form>
        </div>
    </div>

    <!-- Book Detail Modal -->
    <div id="bookDetailModal" class="modal">
        <div class="modal-content" style="max-width: 800px;">
            <span class="close" onclick="closeModal('bookDetailModal')">&times;</span>
            <div id="bookDetailContent">
                <!-- Book detail will be loaded here -->
            </div>
        </div>
    </div>

    <!-- Return Book Modal -->
    <div id="returnBookModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('returnBookModal')">&times;</span>
            <h3><i class="fas fa-undo"></i> Trả sách</h3>
            
            <div class="return-book-info">
                <div class="book-info-row">
                    <strong>Tên sách:</strong> <span id="returnBookTitle"></span>
                </div>
                <div class="book-info-row">
                    <strong>Tác giả:</strong> <span id="returnBookAuthor"></span>
                </div>
                <div class="book-info-row">
                    <strong>Ngày mượn:</strong> <span id="returnBorrowDate"></span>
                </div>
            </div>

            <form id="returnBookForm" onsubmit="event.preventDefault(); submitReturnBook();">
                <div class="form-group">
                    <label for="returnDate">Ngày trả *</label>
                    <input type="date" id="returnDate" required readonly>
                </div>
                
                <div class="form-group">
                    <label for="returnNotes">Ghi chú (tình trạng sách, đánh giá...)</label>
                    <textarea id="returnNotes" rows="4" placeholder="Ví dụ: Sách còn mới, rất hay và bổ ích..."></textarea>
                </div>
                
                <div class="form-actions">
                    <button type="button" class="btn btn-outline" onclick="closeModal('returnBookModal')">
                        Hủy
                    </button>
                    <button type="submit" class="btn btn-success">
                        <i class="fas fa-check"></i> Xác nhận trả sách
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h4>Thư viện Mini</h4>
                    <p>Nơi tri thức hội tụ và lan tỏa</p>
                </div>
                <div class="footer-section">
                    <h4>Liên kết nhanh</h4>
                    <ul>
                        <li><a href="books.html">Danh sách sách</a></li>
                        <li><a href="about.html">Giới thiệu</a></li>
                        <li><a href="contact.html">Liên hệ</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h4>Liên hệ</h4>
                    <p><i class="fas fa-phone"></i> (84) 123-456-789</p>
                    <p><i class="fas fa-envelope"></i> info@thuvienMini.com</p>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 Thư viện Mini. Tất cả quyền được bảo lưu.</p>
            </div>
        </div>
    </footer>

    <script src="js/main.js"></script>
    <script>
        // Initialize user dashboard
        document.addEventListener('DOMContentLoaded', function() {
            // Check user authentication
            if (!window.libraryApp.currentUser || window.libraryApp.currentUser.role !== 'reader') {
                window.location.href = 'index.html';
                return;
            }
            
            loadUserDashboard();
            setupEventListeners();
        });

        function loadUserDashboard() {
            const user = window.libraryApp.currentUser;
            
            // Load user profile
            loadUserProfile(user);
            
            // Load user statistics
            loadUserStats(user.id);
            
            // Load current borrowed books
            loadCurrentBorrowedBooks(user.id);
            
            // Load borrow history
            loadBorrowHistory(user.id);
            
            // Load recommended books
            loadRecommendedBooks(user.id);
        }

        function loadUserProfile(user) {
            document.getElementById('userName').textContent = user.name.split(' ')[0];
            document.getElementById('userFullName').textContent = user.name;
            document.getElementById('userEmail').textContent = user.email;
            document.getElementById('userPhone').textContent = user.phone || 'Chưa cập nhật';
            document.getElementById('joinDate').textContent = window.libraryApp.formatDate(user.joinDate);
        }

        function loadUserStats(userId) {
            const userBorrows = window.libraryApp.borrowRecords.filter(record => record.userId === userId);
            const currentlyBorrowing = userBorrows.filter(record => record.status === 'borrowed').length;
            const totalBorrowed = userBorrows.length;
            
            document.getElementById('currentlyBorrowing').textContent = currentlyBorrowing;
            document.getElementById('totalBorrowed').textContent = totalBorrowed;
            
            // Calculate favorite genre
            const genreCount = {};
            userBorrows.forEach(record => {
                const book = window.libraryApp.books.find(b => b.id === record.bookId);
                if (book) {
                    genreCount[book.category] = (genreCount[book.category] || 0) + 1;
                }
            });
            
            const favoriteGenre = Object.keys(genreCount).reduce((a, b) => 
                genreCount[a] > genreCount[b] ? a : b, 'Chưa có');
            document.getElementById('favoriteGenre').textContent = favoriteGenre;
            
            // Calculate average borrow time
            const returnedBorrows = userBorrows.filter(record => record.returnDate);
            let avgDays = 0;
            if (returnedBorrows.length > 0) {
                const totalDays = returnedBorrows.reduce((sum, record) => {
                    const borrowDate = new Date(record.borrowDate);
                    const returnDate = new Date(record.returnDate);
                    return sum + Math.ceil((returnDate - borrowDate) / (1000 * 60 * 60 * 24));
                }, 0);
                avgDays = Math.round(totalDays / returnedBorrows.length);
            }
            document.getElementById('avgBorrowTime').textContent = avgDays;
        }

        function loadCurrentBorrowedBooks(userId) {
            const currentBorrows = window.libraryApp.borrowRecords.filter(record => 
                record.userId === userId && record.status === 'borrowed'
            );
            
            const container = document.getElementById('currentBooksContainer');
            
            if (currentBorrows.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-book"></i>
                        <h4>Bạn chưa mượn sách nào</h4>
                        <p>Hãy khám phá thư viện và mượn những cuốn sách yêu thích!</p>
                        <a href="books.html" class="btn btn-primary">Xem danh sách sách</a>
                    </div>
                `;
                return;
            }
            
            const booksHtml = currentBorrows.map(record => {
                const book = window.libraryApp.books.find(b => b.id === record.bookId);
                if (!book) return '';
                
                const daysLeft = Math.ceil((new Date(record.borrowDate).getTime() + 14 * 24 * 60 * 60 * 1000 - Date.now()) / (1000 * 60 * 60 * 24));
                
                return `
                    <div class="current-book-card">
                        <img src="${book.image}" alt="${book.title}">
                        <div class="book-info">
                            <h4>${book.title}</h4>
                            <p class="author">${book.author}</p>
                            <p class="borrow-date">Mượn: ${window.libraryApp.formatDate(record.borrowDate)}</p>
                            <p class="due-date ${daysLeft < 3 ? 'overdue' : ''}">
                                ${daysLeft > 0 ? `Còn ${daysLeft} ngày` : `Quá hạn ${Math.abs(daysLeft)} ngày`}
                            </p>
                        </div>
                        <div class="book-actions">
                            <button class="btn btn-primary btn-small" onclick="viewBookDetail(${book.id})">
                                Chi tiết
                            </button>
                            <button class="btn btn-success btn-small" onclick="window.libraryApp.openReturnBookModal(${record.id})">
                                Yêu cầu trả
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
            
            container.innerHTML = booksHtml;
        }

        function loadBorrowHistory(userId) {
            const userBorrows = window.libraryApp.borrowRecords
                .filter(record => record.userId === userId)
                .sort((a, b) => new Date(b.borrowDate) - new Date(a.borrowDate))
                .slice(0, 10); // Show last 10 records
            
            const tbody = document.getElementById('borrowHistoryTable');
            
            if (userBorrows.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" style="text-align: center;">Chưa có lịch sử mượn sách</td></tr>';
                return;
            }
            
            tbody.innerHTML = userBorrows.map(record => {
                const book = window.libraryApp.books.find(b => b.id === record.bookId);
                if (!book) return '';
                
                return `
                    <tr>
                        <td>${book.title}</td>
                        <td>${book.author}</td>
                        <td>${window.libraryApp.formatDate(record.borrowDate)}</td>
                        <td>${record.returnDate ? window.libraryApp.formatDate(record.returnDate) : 'Chưa trả'}</td>
                        <td>
                            <span class="status-badge ${record.status}">
                                ${record.status === 'borrowed' ? 'Đang mượn' : 'Đã trả'}
                            </span>
                        </td>
                        <td class="actions">
                            <button class="btn btn-primary btn-small" onclick="viewBookDetail(${book.id})">
                                <i class="fas fa-eye"></i>
                            </button>
                            ${record.status === 'borrowed' ? 
                                `<button class="btn btn-success btn-small" onclick="window.libraryApp.openReturnBookModal(${record.id})">
                                    <i class="fas fa-undo"></i>
                                </button>` : ''
                            }
                        </td>
                    </tr>
                `;
            }).join('');
        }

        function loadRecommendedBooks(userId) {
            // Simple recommendation based on user's favorite genre
            const userBorrows = window.libraryApp.borrowRecords.filter(record => record.userId === userId);
            const borrowedBookIds = userBorrows.map(record => record.bookId);
            
            // Get user's genres
            const userGenres = [...new Set(userBorrows.map(record => {
                const book = window.libraryApp.books.find(b => b.id === record.bookId);
                return book ? book.category : null;
            }).filter(genre => genre))];
            
            // Recommend books from similar genres that user hasn't borrowed
            let recommendedBooks = window.libraryApp.books.filter(book => 
                !borrowedBookIds.includes(book.id) && 
                userGenres.includes(book.category) &&
                book.status === 'available'
            );
            
            // If no genre-based recommendations, show popular books
            if (recommendedBooks.length === 0) {
                recommendedBooks = window.libraryApp.books
                    .filter(book => !borrowedBookIds.includes(book.id) && book.status === 'available')
                    .sort((a, b) => (b.borrowCount || 0) - (a.borrowCount || 0));
            }
            
            recommendedBooks = recommendedBooks.slice(0, 4);
            
            const container = document.getElementById('recommendedBooks');
            
            if (recommendedBooks.length === 0) {
                container.innerHTML = '<p>Không có sách gợi ý phù hợp.</p>';
                return;
            }
            
            container.innerHTML = recommendedBooks.map(book => `
                <div class="book-card">
                    <div class="book-image">
                        <img src="${book.image}" alt="${book.title}">
                        <div class="book-status available">Có sẵn</div>
                    </div>
                    <div class="book-info">
                        <h4>${book.title}</h4>
                        <p class="author">${book.author}</p>
                        <p class="category">${book.category}</p>
                        <div class="book-actions">
                            <button class="btn btn-primary btn-small" onclick="viewBookDetail(${book.id})">
                                Chi tiết
                            </button>
                            <button class="btn btn-success btn-small" onclick="borrowBook(${book.id})">
                                Mượn
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function setupEventListeners() {
            // Quick search
            document.getElementById('quickSearchInput').addEventListener('keyup', function(e) {
                if (e.key === 'Enter') {
                    quickSearch();
                }
            });
            
            // Edit profile form
            const editProfileForm = document.getElementById('editProfileForm');
            editProfileForm.addEventListener('submit', function(e) {
                e.preventDefault();
                
                const newPassword = document.getElementById('editPassword').value;
                const confirmPassword = document.getElementById('confirmNewPassword').value;
                
                if (newPassword && newPassword !== confirmPassword) {
                    window.libraryApp.showAlert('Mật khẩu xác nhận không khớp!', 'error');
                    return;
                }
                
                // Update user info (in a real app, this would be sent to server)
                const user = window.libraryApp.currentUser;
                user.name = document.getElementById('editName').value;
                user.phone = document.getElementById('editPhone').value;
                
                // Update localStorage
                localStorage.setItem('currentUser', JSON.stringify(user));
                
                // Refresh display
                loadUserProfile(user);
                
                window.libraryApp.showAlert('Cập nhật thông tin thành công!');
                closeModal('editProfileModal');
            });
        }

        function openEditProfileModal() {
            const user = window.libraryApp.currentUser;
            document.getElementById('editName').value = user.name;
            document.getElementById('editEmail').value = user.email;
            document.getElementById('editPhone').value = user.phone || '';
            document.getElementById('editProfileModal').style.display = 'block';
        }

        function quickSearch() {
            const query = document.getElementById('quickSearchInput').value.trim();
            if (!query) return;
            
            const results = window.libraryApp.books.filter(book => 
                book.title.toLowerCase().includes(query.toLowerCase()) ||
                book.author.toLowerCase().includes(query.toLowerCase())
            ).slice(0, 5);
            
            const container = document.getElementById('quickSearchResults');
            
            if (results.length === 0) {
                container.innerHTML = '<p>Không tìm thấy sách nào.</p>';
                container.style.display = 'block';
                return;
            }
            
            container.innerHTML = results.map(book => `
                <div class="search-result-item">
                    <img src="${book.image}" alt="${book.title}">
                    <div class="result-info">
                        <h4>${book.title}</h4>
                        <p>${book.author}</p>
                        <span class="status ${book.status}">
                            ${book.status === 'available' ? 'Có sẵn' : 'Đã mượn'}
                        </span>
                    </div>
                    <div class="result-actions">
                        <button class="btn btn-primary btn-small" onclick="viewBookDetail(${book.id})">
                            Chi tiết
                        </button>
                        ${book.status === 'available' ? 
                            `<button class="btn btn-success btn-small" onclick="borrowBook(${book.id})">
                                Mượn
                            </button>` : ''
                        }
                    </div>
                </div>
            `).join('');
            
            container.style.display = 'block';
        }

        function viewBookDetail(bookId) {
            // Reuse the book detail modal from books.html
            const book = window.libraryApp.books.find(b => b.id === bookId);
            if (!book) return;

            const modal = document.getElementById('bookDetailModal');
            const content = document.getElementById('bookDetailContent');
            
            content.innerHTML = `
                <div class="book-detail-modal">
                    <div class="book-detail-image">
                        <img src="${book.image}" alt="${book.title}">
                        <div class="book-status-large ${book.status}">
                            ${book.status === 'available' ? 'Có sẵn' : 'Đã mượn'}
                        </div>
                    </div>
                    <div class="book-detail-info">
                        <h2>${book.title}</h2>
                        <p class="book-author"><i class="fas fa-user"></i> ${book.author}</p>
                        <p class="book-category"><i class="fas fa-tag"></i> ${book.category}</p>
                        <p class="book-borrow-count"><i class="fas fa-chart-line"></i> Đã mượn ${book.borrowCount || 0} lần</p>
                        
                        <div class="book-description">
                            <h4>Mô tả</h4>
                            <p>${book.description}</p>
                        </div>
                        
                        <div class="book-actions">
                            ${book.status === 'available' ? 
                                `<button class="btn btn-primary" onclick="borrowBook(${book.id}); closeModal('bookDetailModal')">
                                    <i class="fas fa-hand-holding"></i> Mượn sách
                                </button>` : 
                                `<button class="btn btn-outline" disabled>
                                    <i class="fas fa-ban"></i> Sách đã được mượn
                                </button>`
                            }
                        </div>
                    </div>
                </div>
            `;
            
            modal.style.display = 'block';
        }

        function borrowBook(bookId) {
            if (window.libraryApp.borrowBook(bookId)) {
                loadUserDashboard(); // Refresh dashboard
            }
        }

        function requestReturn(recordId) {
            window.libraryApp.openReturnBookModal(recordId);
        }
    </script>

    <style>
        .user-profile {
            margin-bottom: 3rem;
        }

        .profile-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 2rem;
            border-radius: 15px;
            display: flex;
            align-items: center;
            gap: 2rem;
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
        }

        .profile-avatar {
            font-size: 4rem;
            opacity: 0.9;
        }

        .profile-info {
            flex: 1;
        }

        .profile-info h2 {
            margin-bottom: 0.5rem;
            font-size: 1.8rem;
            font-weight: 700;
        }

        .profile-info p {
            margin-bottom: 0.3rem;
            opacity: 0.9;
        }

        .profile-info small {
            opacity: 0.7;
        }

        .user-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-bottom: 3rem;
        }

        .user-stats .stat-item {
            background: white;
            padding: 1.5rem;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .user-stats .stat-icon {
            background: #f8f9ff;
            color: #667eea;
            width: 50px;
            height: 50px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
        }

        .current-book-card {
            background: white;
            border-radius: 15px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            box-shadow: 0 3px 15px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            gap: 1.5rem;
        }

        .current-book-card img {
            width: 80px;
            height: 110px;
            object-fit: cover;
            border-radius: 8px;
        }

        .current-book-card .book-info {
            flex: 1;
        }

        .current-book-card .book-info h4 {
            margin-bottom: 0.5rem;
            color: #333;
        }

        .current-book-card .author {
            color: #667eea;
            margin-bottom: 0.5rem;
        }

        .current-book-card .borrow-date {
            color: #666;
            font-size: 0.9rem;
            margin-bottom: 0.3rem;
        }

        .current-book-card .due-date {
            font-weight: 600;
            font-size: 0.9rem;
        }

        .current-book-card .due-date.overdue {
            color: #ff6b6b;
        }

        .current-book-card .book-actions {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .empty-state {
            text-align: center;
            padding: 3rem;
            color: #666;
        }

        .empty-state i {
            font-size: 3rem;
            margin-bottom: 1rem;
            color: #999;
        }

        .empty-state h4 {
            margin-bottom: 1rem;
            color: #333;
        }

        .quick-search-results {
            background: white;
            border-radius: 10px;
            margin-top: 1rem;
            border: 1px solid #e9ecef;
            max-height: 400px;
            overflow-y: auto;
        }

        .search-result-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            border-bottom: 1px solid #f1f3f4;
        }

        .search-result-item:last-child {
            border-bottom: none;
        }

        .search-result-item img {
            width: 50px;
            height: 70px;
            object-fit: cover;
            border-radius: 5px;
        }

        .search-result-item .result-info {
            flex: 1;
        }

        .search-result-item .result-info h4 {
            margin-bottom: 0.3rem;
            font-size: 1rem;
        }

        .search-result-item .result-info p {
            color: #667eea;
            font-size: 0.9rem;
            margin-bottom: 0.3rem;
        }

        .search-result-item .status {
            font-size: 0.8rem;
            padding: 2px 8px;
            border-radius: 10px;
        }

        .search-result-item .status.available {
            background: #d4edda;
            color: #155724;
        }

        .search-result-item .status.borrowed {
            background: #f8d7da;
            color: #721c24;
        }

        .search-result-item .result-actions {
            display: flex;
            gap: 0.5rem;
        }

        .user-welcome {
            color: white;
            margin-right: 1rem;
            font-weight: 500;
        }

        @media (max-width: 768px) {
            .profile-card {
                flex-direction: column;
                text-align: center;
            }
            
            .current-book-card {
                flex-direction: column;
                text-align: center;
            }
            
            .current-book-card .book-actions {
                flex-direction: row;
                justify-content: center;
            }
            
            .search-result-item {
                flex-direction: column;
                text-align: center;
            }
            
            .search-result-item .result-actions {
                justify-content: center;
            }
        }
    </style>

    <!-- Return Book Modal -->
    <div id="returnBookModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('returnBookModal')">&times;</span>
            <h3>Trả sách</h3>
            <div id="returnBookInfo">
                <!-- Book return info will be loaded here -->
            </div>
            <form id="returnBookForm">
                <input type="hidden" id="returnBorrowId">
                
                <div class="form-group">
                    <label for="returnDate">Ngày trả *</label>
                    <input type="date" id="returnDate" required>
                </div>

                <div class="form-group">
                    <label for="returnNotes">Ghi chú</label>
                    <textarea id="returnNotes" rows="3" placeholder="Tình trạng sách khi trả, nhận xét..."></textarea>
                </div>

                <div class="form-actions">
                    <button type="button" class="btn btn-outline" onclick="closeModal('returnBookModal')">Hủy</button>
                    <button type="submit" class="btn btn-success">
                        <i class="fas fa-undo"></i> Xác nhận trả sách
                    </button>
                </div>
            </form>
        </div>
    </div>
</body>
</html>